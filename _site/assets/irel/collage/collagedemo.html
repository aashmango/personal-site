<!DOCTYPE html>
<html>
<head>

  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>

  <script
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAsJyRZhJ-4Qffyf5HZiLIKkRd9wCM-KLs">
  </script>
  <script src="v3_epoly.js" type="text/javascript"> </script>

  <style type="text/css">
  html, body { height: 100%; margin: 0; padding: 0;}

  body {
    position: relative;

  }

  #map { height: 100%; }

  #tools {font-family: 'Open Sans', 
  sans-serif; font-weight: 700;}
  
  input[type="text"] {
  display: block;
  font-family: 'Open Sans', sans-serif; 
  font-weight: 400;
  font-size: 14px;
  border: solid 2px black;
  padding: 2px;
  margin: 25px;
  width: 200px;
   padding-top: 5px;
  padding-bottom: 5px;
  padding-left: 5px;
}

input[type="submit"] {
  display: block;
  
  background-color: black;
  font-family: 'Open Sans', sans-serif; 
  font-weight: 700;
  font-size: 14px;
  appearance: none;
  box-shadow: none;
  border: solid 2px black;
  padding: 2px;
  padding-top: 5px;
  padding-bottom: 5px;
  color: white;
  text-transform: uppercase;
  width: 210px;
  margin: 25px;
}

#sidetext {
  margin: 25px;
  margin-bottom: -20px;
  font-size: 12px;
}
#headtext {
  margin: 25px;
  margin-bottom: -20px;
  color: red;
  font-weight: 400;
  font-size: 14px;
  padding-bottom: 20px;
  width: 220px;
}


.fb-like {
  position: absolute;
  margin: 5px;
}
  </style>

</head>

<!-- <body onload="initialize()"> -->
<body>




  <div id="tools">
    <p id = "headtext">Contribute to the urban collage by entering a route below:</p>
    <div id = "sidetext">ORIGIN</div>
    <input type="text" name="START"  id="start" value="Istanbul">
    <div id = "sidetext">DESTINATION</div>
    <input type="text" name="END" id="end" value="Paris">

    <input type="submit" onclick="runloop();">
  </div>




  <script type="text/javascript">

  var addresses = [
  {
    origin: "Hoboken, NJ",
    destination: "Carroll Gardens, Brooklyn"
  },
  {
    origin: "Providence, RI",
    destination: "Chicago, IL"
  },
  {
    origin: "New York, NY",
    destination: "Austin, TX"
  },
  {
    origin: "Rome",
    destination: "Paris"
  },
  {
    origin: "London",
    destination: "Amsterdam"
  }

  ]

   // console.log(addresses.length);



   function runloop() {
    document.getElementById('tools').style.visibility = "hidden";
    document.getElementById('tools').style.height = "0px";
    document.getElementById('sidetext').style.margin = "0px";
    document.getElementById('headtext').style.margin = "0px";

    for(var i=0; i < 6; i++){

      var newmapcanvas = document.createElement('div');
      newmapcanvas.id = 'map_canvas'+i;


      document.body.appendChild(newmapcanvas);

      

      document.getElementById('map_canvas'+i).style.width = "100%";
      document.getElementById('map_canvas'+i).style.height = "24%";
      document.getElementById('map_canvas'+i).style.float = "left";
      document.getElementById('map_canvas'+i).style.marginBottom = "-2%";
      document.getElementById('map_canvas'+i).style.position = "relative";

      if (i==5) {
      document.getElementById('map_canvas'+i).style.visibility = "hidden";
    }

    

      initialize(i);
      calcRoute(i);

    }

    var newtextcontent = document.createElement('div');
      newtextcontent.id = 'text_content';
      document.body.appendChild(newmapcanvas);
  }

  // function runloop_2() {
  //   for(var i=0; i < addresses.length; i++){
  //     calcRoute(i);
  //   }
  // }

  var allmaps = [];
  var map;
  var directionDisplay;
  var directionsService;
  var stepDisplay;
  var markerArray = [];
  var position;
  var marker = null;
  var polyline = null;
  var poly2 = null;
  var speed = 0.000001, wait = 1;
  var infowindow = null;

  var myPano;   
  var panoClient;
  var nextPanoId;
  var timerHandle = null;

  function createMarker(latlng,markerindex) {
// alert("createMarker("+latlng+","+label+","+html+","+color+")");

var marker = new google.maps.Marker({
  position: latlng,
  map: allmaps[markerindex],
  zIndex: Math.round(latlng.lat()*-100000)<<5
});

return marker;
}


function initialize(mapindex) {

 var style_array = [
  {
    featureType: "all",
    elementType: "labels",
    stylers: [
      { visibility: "off" }
    ]

  }
];

  infowindow = new google.maps.InfoWindow({ 
    size: new google.maps.Size(150,50)
  });

    // Instantiate a directions service.
    directionsService = new google.maps.DirectionsService();
    
    // Create a map and center it on Manhattan.
    var myOptions = {
      zoom: 12+(mapindex),
      mapTypeId: google.maps.MapTypeId.SATELLITE,
      disableDefaultUI: true,
      backgroundColor: "white"

      // styles: style_array

    }

    
    map = new google.maps.Map(document.getElementById("map_canvas"+mapindex), myOptions);
    map.setTilt(0);
    allmaps.push(map);

    // console.log(addresses[mapindex].origin);
   //  // address = "\""+(addresses[mapindex].origin)+"\"";
   //  address = "new york";

   //  geocoder = new google.maps.Geocoder();
   //  geocoder.geocode( { 'address': address}, function(results, status) {
   //   allmaps[mapindex].setCenter(results[0].geometry.location)
   // });
    
    
   //  // Create a renderer for directions and bind it to the map.
   //  var rendererOptions = {
   //    map: allmaps[mapindex]
   //  }
   //  directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);
    
    // Instantiate an info window to hold step text.
    stepDisplay = new google.maps.InfoWindow();

    polyline = new google.maps.Polyline({
      path: [],
      strokeColor: '#FF0000',
      strokeWeight: 3
    });
    poly2 = new google.maps.Polyline({
      path: [],
      strokeColor: '#2222dd',
      strokeWeight: 5
    });

    
  }



  var steps = []
  // runloop();
// console.log(allmaps);


function calcRoute(routeindex){

  // if (timerHandle) { clearTimeout(timerHandle); }
  // if (marker) { marker.setMap(null);}
  // polyline.setMap(null);
  // poly2.setMap(null);
  // directionsDisplay.setMap(null);
  
  polyline = new google.maps.Polyline({
    path: [],
    strokeColor: '#FF0000',
    strokeWeight: 3
  });

  poly2 = new google.maps.Polyline({
    path: [],
    strokeColor: '#ffffff',
    strokeWeight: 3
  });
    // Create a renderer for directions and bind it to the map.
    var rendererOptions = {
      map: allmaps[routeindex]
    }
    directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);

    var start = document.getElementById("start").value;

    // console.log(document.getElementById("start").value);

    // var start = addresses[routeindex].origin.value;
    // var start = "\""+(addresses[routeindex].origin)+"\""
   
    
    var end = document.getElementById("end").value;
    // var end = addresses[routeindex].destination.value;
    // var end = "\""+(addresses[routeindex].destination)+"\""
    // console.log(start+" and "+end);
    // console.log(end);
    var travelMode = google.maps.DirectionsTravelMode.DRIVING;


    var request = {
      origin: start,
      destination: end,
      travelMode: travelMode
    };

    // Route the directions and pass the response to a
    // function to create markers for each step.
    directionsService.route(request, function(response, status) {
      if (status == google.maps.DirectionsStatus.OK){
        directionsDisplay.setDirections(response);

        var bounds = new google.maps.LatLngBounds();
        var route = response.routes[0];
        startLocation = new Object();
        endLocation = new Object();

        // For each route, display summary information.
        var path = response.routes[0].overview_path;
        var legs = response.routes[0].legs;
        for (i=0;i<legs.length;i++) {
          if (i == 0) { 
            startLocation.latlng = legs[i].start_location;

            startLocation.address = legs[i].start_address;
            // console.log(startLocation.address);
            
            marker = createMarker(legs[i].start_location,allmaps[routeindex]);
          }
          endLocation.latlng = legs[i].end_location;
          endLocation.address = legs[i].end_address;
          var steps = legs[i].steps;
          for (j=0;j<steps.length;j++) {
            var nextSegment = steps[j].path;
            for (k=0;k<nextSegment.length;k++) {
              polyline.getPath().push(nextSegment[k]);
              bounds.extend(nextSegment[k]);

            }
          }
        }

        polyline.setMap(allmaps[routeindex]);
        // allmaps[routeindex].fitBounds(bounds);
//        createMarker(endLocation.latlng,"end",endLocation.address,"red");
allmaps[routeindex].setZoom(13+routeindex);
startAnimation(routeindex);
}                                                    
});
}



      
      var eol;
      var k=0;
      var stepnum=0;
      var speed = "";
      var lastVertex = 1;


//=============== animation functions ======================
function updatePoly(d) {

        // Spawn a new polyline every 20 vertices, because updating a 100-vertex poly is too slow
        if (poly2.getPath().getLength() > 20) {
          poly2=new google.maps.Polyline([polyline.getPath().getAt(lastVertex-1)]);
          // map.addOverlay(poly2)
        }

        if (polyline.GetIndexAtDistance(d) < lastVertex+2) {
         if (poly2.getPath().getLength()>1) {
           poly2.getPath().removeAt(poly2.getPath().getLength()-1)
         }
         poly2.getPath().insertAt(poly2.getPath().getLength(),polyline.GetPointAtDistance(d));
       } else {
        poly2.getPath().insertAt(poly2.getPath().getLength(),endLocation.latlng);
      }
    }


    function animate(animateindex,d) {
      var step = 10;
      // var step_calc = 200/(animateindex^2); // 5; // metres
      // var step = step_calc.toFixed(0);
      var tick = 100; // milliseconds


  // console.log(allmaps[animateindex]);
// alert("animate("+d+")");
if (d>eol) {
  allmaps[animateindex].panTo(endLocation.latlng);
  marker.setPosition(endLocation.latlng);
  return;

}
var p = polyline.GetPointAtDistance(d);
allmaps[animateindex].panTo(p);
marker.setPosition(p);
updatePoly(d);
timerHandle = setTimeout("animate("+animateindex+","+(d+step)+")", tick);
}


function startAnimation(startindex) {
  eol=polyline.Distance();
  allmaps[startindex].setCenter(polyline.getPath().getAt(0));
        // map.addOverlay(new google.maps.Marker(polyline.getAt(0),G_START_ICON));
        // map.addOverlay(new GMarker(polyline.getVertex(polyline.getVertexCount()-1),G_END_ICON));
        // marker = new google.maps.Marker({location:polyline.getPath().getAt(0)} /* ,{icon:car} */);
        // map.addOverlay(marker);
        poly2 = new google.maps.Polyline({path: [polyline.getPath().getAt(0)], strokeColor:"#0000FF", strokeWeight:10});
        // map.addOverlay(poly2);
        setTimeout("animate("+startindex+",10)",20);  // Allow time for the initial map display
      }


//=============== ~animation funcitons =====================




</script>



</body>
</html>